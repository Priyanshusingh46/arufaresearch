"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.setupRust = void 0;
const child_process_1 = require("child_process");
const config_env_1 = require("../internal/core/config/config-env");
const task_names_1 = require("./task-names");
function default_1() {
    (0, config_env_1.task)(task_names_1.TASK_INSTALL, "Setup rust compiler")
        .setAction(taskRust);
}
exports.default = default_1;
async function taskRust(_taskArgs, env) {
    return await setupRust(env);
}
async function setupRust(env) {
    (0, child_process_1.execSync)(`curl --proto '=https' --tlsv1.2 -sSf -y https://sh.rustup.rs | sh`);
    (0, child_process_1.execSync)(`export PATH="${process.env.HOME}/.cargo/bin:${process.env.PATH}"`); // eslint-disable-line  @typescript-eslint/restrict-template-expressions
    if (env.config.rust) {
        (0, child_process_1.execSync)(`rustup default ${env.config.rust.version}`);
    }
    else {
        (0, child_process_1.execSync)(`rustup default stable`);
    }
    (0, child_process_1.execSync)(`rustup target list --installed`);
    (0, child_process_1.execSync)(`rustup target add wasm32-unknown-unknown`);
    return true;
}
exports.setupRust = setupRust;
